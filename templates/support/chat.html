{% extends "base.html" %}

{% block title %}Support - SocialMarket{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-info text-white">
                    <h4 class="mb-0"><i class="fas fa-headset me-2"></i>Contact Support</h4>
                </div>
                <div class="card-body p-4">
                    {% if not current_user.is_authenticated %}
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Login Required:</strong> Please <a href="{{ url_for('auth.login') }}">login</a> to submit a support request.
                    </div>
                    {% else %}
                    <form method="POST" novalidate>
                        {{ form.hidden_tag() }}
                        
                        <div class="mb-3">
                            {{ form.subject.label(class="form-label fw-bold") }}
                            {{ form.subject(class="form-control", placeholder="Brief description of your issue") }}
                            {% if form.subject.errors %}
                            <div class="text-danger mt-1">
                                {% for error in form.subject.errors %}
                                    <div><i class="fas fa-exclamation-triangle me-1"></i>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-4">
                            {{ form.message.label(class="form-label fw-bold") }}
                            {{ form.message(class="form-control", rows="6", placeholder="Please describe your issue in detail. Include any relevant information such as error messages, account details, or transaction IDs.") }}
                            {% if form.message.errors %}
                            <div class="text-danger mt-1">
                                {% for error in form.message.errors %}
                                    <div><i class="fas fa-exclamation-triangle me-1"></i>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                            <div class="form-text">Maximum 1000 characters</div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Response Time:</strong> Our support team typically responds within 24 hours. For urgent issues, please mark them clearly in your subject line.
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                            </a>
                            <button type="submit" class="btn btn-info btn-lg">
                                <i class="fas fa-paper-plane me-2"></i>Send Message
                            </button>
                        </div>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <!-- FAQ Section -->
            <div class="card shadow mb-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-question-circle me-2"></i>Frequently Asked Questions</h6>
                </div>
                <div class="card-body">
                    <div class="accordion" id="faqAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                    How do I verify my account?
                                </button>
                            </h2>
                            <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <small>Complete your email verification first, then upload your KYC documents in the profile section. Our team will review within 24-48 hours.</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                    How long does payment verification take?
                                </button>
                            </h2>
                            <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <small>Bank transfer verifications typically take 1-3 business days. Make sure to include the correct reference in your transfer.</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                    What happens after I purchase an account?
                                </button>
                            </h2>
                            <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <small>After payment verification, you'll receive the account login details in your dashboard. Change the password immediately for security.</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                                    How does the referral program work?
                                </button>
                            </h2>
                            <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <small>Share your referral link and earn 5% commission on each referral's first purchase. Commission is automatically added to your wallet.</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Contact Information -->
            <div class="card shadow mb-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-envelope me-2"></i>Other Ways to Reach Us</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <i class="fas fa-envelope text-primary me-2"></i>
                        <strong>Email:</strong>
                        <br><small class="text-muted">support@socialmarket.com</small>
                    </div>
                    <div class="mb-3">
                        <i class="fab fa-telegram text-info me-2"></i>
                        <strong>Telegram:</strong>
                        <br><small class="text-muted">@SocialMarketSupport</small>
                    </div>
                    <div class="mb-3">
                        <i class="fas fa-clock text-warning me-2"></i>
                        <strong>Response Time:</strong>
                        <br><small class="text-muted">24 hours or less</small>
                    </div>
                    <div>
                        <i class="fas fa-shield-alt text-success me-2"></i>
                        <strong>Security:</strong>
                        <br><small class="text-muted">Never share passwords in support messages</small>
                    </div>
                </div>
            </div>
            
            <!-- Your Previous Messages -->
            {% if current_user.is_authenticated and messages %}
            <div class="card shadow">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-history me-2"></i>Your Recent Messages</h6>
                </div>
                <div class="card-body">
                    {% for message in messages[:3] %}
                    <div class="mb-3 pb-3 {% if not loop.last %}border-bottom{% endif %}">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="mb-1">{{ message.subject }}</h6>
                            <span class="badge bg-{% if message.status == 'open' %}danger{% elif message.status == 'in_progress' %}warning{% else %}success{% endif %}">
                                {{ message.status.replace('_', ' ').title() }}
                            </span>
                        </div>
                        <p class="text-muted small mb-2">{{ message.message[:80] }}{% if message.message|length > 80 %}...{% endif %}</p>
                        <small class="text-muted">{{ message.created_at.strftime('%B %d, %Y') }}</small>
                        {% if message.admin_response %}
                        <div class="mt-2 p-2 bg-success bg-opacity-10 rounded">
                            <small class="text-success">
                                <i class="fas fa-reply me-1"></i>
                                <strong>Admin Response:</strong> {{ message.admin_response[:60] }}{% if message.admin_response|length > 60 %}...{% endif %}
                            </small>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                    
                    {% if messages|length > 3 %}
                    <div class="text-center">
                        <small class="text-muted">{{ messages|length - 3 }} more messages...</small>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Auto-expand textarea as user types
document.addEventListener('DOMContentLoaded', function() {
    const textarea = document.getElementById('message');
    if (textarea) {
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    }
    
    // Character counter
    const messageField = document.getElementById('message');
    if (messageField) {
        const maxLength = 1000;
        const counter = document.createElement('small');
        counter.className = 'text-muted float-end';
        messageField.parentNode.appendChild(counter);
        
        function updateCounter() {
            const remaining = maxLength - messageField.value.length;
            counter.textContent = `${remaining} characters remaining`;
            counter.className = remaining < 100 ? 'text-warning float-end' : 'text-muted float-end';
        }
        
        messageField.addEventListener('input', updateCounter);
        updateCounter();
    }
});
</script>
{% endblock %}
